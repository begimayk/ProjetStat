---
title: "Projet Stats"
output:
  html_document: default
  pdf_document: default
date: "2023-05-05"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Check if the package is installed; if not, install it
if (!require(ggplot2)) {
  install.packages("ggplot2")
  library(ggplot2)
}

```
## Introduction

### Données

Les données sont prises de https://www.kaggle.com/ .
Les données concernent les joueuses de volleyball et contiennent des informations sur leur date de naissance, leur taille, leur poids, leur hauteur de saut (spike), leur hauteur de bloc, leur poste de jeu et leur pays d'origine.

La date de naissance, la taille et le poids sont des caractéristiques physiques des joueuses qui peuvent avoir une incidence sur leurs performances. La hauteur de saut (spike) et de bloc sont également des facteurs importants dans le volleyball, car ils mesurent la capacité d'une joueuse à attaquer et à défendre. Le poste de jeu de la joueuse est également une information importante, car chaque poste a des responsabilités et des rôles différents sur le terrain. Enfin, le pays d'origine peut également avoir une incidence sur le style de jeu et le niveau de compétition des joueuses.

En utilisant ces données, il est possible de mener des analyses statistiques pour étudier la relation entre ces caractéristiques et les performances des joueuses sur le terrain, ainsi que pour étudier les différences entre les joueuses de différents pays et postes de jeu. Ces informations peuvent être utiles pour les entraîneurs et les recruteurs pour sélectionner les joueuses les plus adaptées à leur équipe, ainsi que pour les chercheurs qui s'intéressent aux facteurs qui influencent les performances sportives.

### Chargement de données 

```{r}

url <- "women_vb.csv"
data <- read.csv(url,sep=';', header=TRUE)

attach(data)

```
### Modififcations apportées aux données 



Voici le fichier de donées de départ : https://www.kaggle.com/datasets/johnpendenque/women-volleyball-players.
Afin de mieux organiser ces données, nous avons effectué une transformation en remplaçant les codes des pays d'origine des joueuses ainsi que les codes de leurs postes par les noms correspondants. Cela a été réalisé dans le but de rendre les données plus compréhensibles et faciles à interpréter.


### Variables pour l'analyse


Nous allons effectuer une analyse statistique des données fournies, en commençant par comparer les fréquences des nationalités des joueuses. Ensuite, nous étudierons les capacités et aptitudes des joueuses, à savoir la hauteur maximale d'attaque et la hauteur maximale de blocage, en fonction de leur poste. Ces deux variables sont qualitatives.

Pour approfondir cette étude, nous analyserons également les aptitudes des joueuses en fonction de leurs postes. Cette analyse portera sur des variables quantitatives, ce qui nous permettra d'explorer plus en détail les différences et les tendances entre les postes occupés par les joueuses.


## Analyse univariée


### Pays de naissance des joueuses

Nous allons commencer par effectuer une analyse des pays de naissance des joueuses, qui représente une variable _qualitative discrète_. 


##### Tri à plat
Pour résumer l'information contenue dans la variable nous commençons par un _tri à plat_
```{r}
# Calculer les effectifs de chaque pays
pays_eff <- table(pays)
```


### Répartition des données

```{r}

# Créer les couleurs
pale_colors <- c("#F2B5D4", "#B8E3E6", "#FFDB9A", "#B3D9B2", "#FAC8A7", "#D7D7E0",
                "#F9E6B8", "#B7C9E2", "#F1C2DC", "#C9E8C9", "#FFE4C4", "#D0E0EB")

# Créer le diagramme en camembert
pie(pays_eff, paste(names(pays_eff), "(", formatC(pays_eff, format = "f", digits = 0), ")", sep = ""), col = pale_colors)

# Ajouter la legende
legend("topright", legend = names(pays_eff), fill = pale_colors, cex = 0.8)

```


En analysant ce diagramme, il est clair que la plupart des pays de naissance des joueuses ont une fréquence de 12, ce qui signifie qu'il y a un nombre égal de joueuses nées dans ces pays. Cependant, il y a deux exceptions à cette tendance : le Japon et le Mexique, qui sont les pays de naissance de 11 joueuses chacun.

Il est intéressant de noter que la Bulgarie présente la fréquence maximale dans ce diagramme, avec 13 joueuses nées dans ce pays. Cela indique que la Bulgarie est le pays d'origine le plus représenté parmi les joueuses.


### Hauteur d'attaque des joueuses

```{r}
# Calcul de la fonction de répartition empirique
ecdf_attaque <- ecdf(attaque)

# Tracé de la fonction de répartition empirique
plot(ecdf_attaque, main = "Fonction de répartition empirique - Attaque", xlab = "Attaque", ylab = "Probabilité", xlim = range(attaque))

```


Les nombreux sauts de petite taille observés dans la variable suggèrent fortement que cette variable _quantitative_ est _continue_.

Étant donné que la variable en question est continue, il est approprié de réaliser un regroupement en classes des données.
```{r}
# Regroupement en classes
classes_attaque <- cut(attaque,breaks = c(100, 200, 300, 400))

# Affichage des classes
print(classes_attaque)
```
Dans le cadre de notre analyse, nous supposons que les points de données au sein de chaque classe sont répartis uniformément.

#### Mesures de position
```{r}
boxplot(attaque, main="La hauteur d'attaque des joueuses de volley")
```


En observant ce diagramme, on peut clairement distinguer la valeur minimale, les quartiles, la médiane et la valeur maximale.

Voici ces valeurs 
```{r}
summary(attaque)
```

### Probabilité et estimations 

#### Estimation de moyenne

```{r}
interval=t.test(attaque)
interval$conf.int
mean(attaque)
```

Nous pouvons estimer que la moyenne de l'attaque se situe dans l'intervalle [284.5521, 293.0283] avec un niveau de confiance de 95%.


#### Estimation de variance 
```{r}
# Calcul de l'intervalle de confiance pour la variance
n <- length(attaque)  # Taille de l'échantillon
alpha <- 0.05  # Niveau de confiance (ici 95%)

lower_bound <- (n - 1) * var(attaque) / qchisq(1 - alpha/2, df = n - 1)
upper_bound <- (n - 1) * var(attaque) / qchisq(alpha/2, df = n - 1)

# Affichage de l'intervalle de confiance
confidence_interval <- c(lower_bound, upper_bound)
confidence_interval
var(attaque)
```
De même nous estimons que la variance de la hauteur d'attaque des joueuses se situe dans l'intervalle [527.6508 841.5602] avec un niveau de confiance de 95%.

#### Comparaison à la loi normale

```{r}
par(mfrow=c(1,2))
hist(attaque , main="Repartition de la hauteur d'attaque ",xlab="La hauteur d'attaque",prob=T)
curve(dnorm(x, mean(attaque), sd(attaque)), col=2, add=TRUE, lty=2)

qqnorm(attaque, main = "La loi normale", xlab = "Théorique", ylab = "Observé")
abline(mean(attaque),sd(attaque),col=2)
```

Sur ce graphique, nous pouvons observer que la distribution de la variable d'attaque s'approche à loi normale.

Pour valider notre estimations, nous procéderons aux tests statistiques.

#### Test de la normalité de distribution

Les hypothèses sont les suivantes :

* H0 : La variable suit la loi normale 
* H1 : La variable ne suit pas la loi normale
```{r}
shapiro.test(attaque)
```
La p valeur du test est extrêmement faible, soit 1.619e-13, ce qui indique que nous avons suffisamment de preuves pour rejeter l'hypothèse nulle  H0 selon laquelle les données suivent une distribution normale.


## Analyse bivariée

### Hauteur d'attaque des joueuses de volleyball selon leur pays de naissance

Après avoir étudié les pays de naissance des joueuses et leurs hauteurs d'attaque, nous pouvons désormais analyser la hauteur d'attaque selon le pays de naissance des joueuses.

La hauteur d'attaque des joueuses est une variable _quantitative continue_, tandis que leur pays de naissance est une variable _qualitative discrète_.


```{r}
attaque<-data$attaque

ggplot(data, aes(x = pays, y = attaque)) +
  geom_boxplot() +
  labs(title = "La hauteur d'attaque moyenne des joueuses en fonction de leur pays de naissance",
       x = "Pays de naissance",
       y = "La hauteur d'attaque") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Ce graphique en boîte permet d'observer les quartiles et la médiane de la hauteur d'attaque des joueuses des différents sous-groupes, représentés par leur nationalité. Chaque boîte représente la distribution de la hauteur d'attaque pour un pays spécifique.

Maintenant que nous avons examiné les résultats graphiques, nous pouvons utiliser ces données pour effectuer des tests statistiques. Voici les tests que nous effectuerons en utilisant les résultats de la hauteur d'attaque des différentes nationalités :

* Test de comparaison de moyennes : Sur le graphique, nous remarquons une similitude des moyennes de la hauteur d'attaque entre la Chine et Cuba. Afin de vérifier si cette similitude est statistiquement significative, nous allons effectuer un test d'égalité des moyennes entre ces deux pays.
* Test de comparaison de variances : De même nous observons une similarité entre les variances enre la Cuba et l'Egypte, nous allons donc effectuer un test d'égalité des moyennes pour ces deux pays et ensuite un test d'égalité des variances.


#### Tests statistiques 

* Test d'égalité des moyennes de la hauteur d'attaque entre la Chine et la Cuba. Les hypothèses sont les suivantes 

  + H0 Les moyennes sont égales
  + H1 Les moyennes sont différentes


##### Tests d'égalité des moyennes

```{r}
attaque_cuba <- attaque[pays == "Cuba"]
attaque_china <- attaque[pays == "China"]
t.test(attaque_cuba, attaque_china)
```

La p-valeur est grande (26,32%) par rapport au risque de 5% de se tromper. Nous pouvons donc accepter l'hypothèse nulle HO selon laquelle les deux moyennes sont égales et rejetter l'hypothèse H1 selon laquelle les deux moyennes sont différentes. Nous constatons également que la différence entre ces deux moyennes se trouve dans l'intervalle [-32.8, 9.8] avec un niveau de confiance de 95%.


##### Tests d'égalité des variances


Pour effectuer des tests d'égalité des variances, il est recommandé de vérifier d'abord l'adéquation à la distribution normale des échantillons concernés. Dans notre cas, nous avons deux sous-groupes : Cuba et Égypte. Nous allons donc procéder à des tests de normalité pour ces deux groupes.

Les hypothèses sont les suivantes 

* H0 : La variable suit la loi normale
* H1 : La variable ne suit pas la loi normale 

```{r}
hist(data[data$pays == "Cuba", "attaque"])
shapiro.test(data[data$pays == "Cuba", "attaque"])
hist(data[data$pays == "Egypte", "attaque"])
shapiro.test(data[data$pays == "Egypte", "attaque"])
```
Pour les deux tests la p-valeur obtenue est petite, donc nous ne pouvons pas rejjeter l'hypothèse nulle selon laquelle la variable suit la loi normale. Nous supposons donc par la suite que ces deux échantillons ne suivent pas une distribution normale.

Vu que nos échantillons ne suivent pas une distribution normale de ces deux échantillon avec un test Fisher

* Test d'égalité des variance entre la Cuba et l'Egypte 

  + H0 Les variances sont égales
  + H1 Les variances sont différentes
  
````{r}
attaque_egypt <- attaque[pays == "Egypte"]
var.test(attaque_cuba, attaque_egypt)
````
La p-valeur est petite mais légérement plus grande que le risque de 5% nous ne pouvons donc pas rejetter l'hypothèse nulle selon laquelle les variances sont égales.

Nous supposons dans la suite que les variances de ces deux échantillons sont égales.


* Test d'égalité des moyennes de la hauteur d'attaque entre la Cuba et l'Égypte. Les hypothèses sont les suivantes 

  + H0 Les moyennes sont égales
  + H1 Les moyenne sont différentes

```{r}
t.test(attaque_cuba, attaque_egypt, var.equal = T)
```
La p-valeur est plus petite que dans le premier test mais elle reste supérieure au risque de 5%. Nous n'avons donc pas suffisament de preuve pour rejetter l'hypothèse nulle HO selon laquelle les deux moyennes sont égales par consequent nous l'acceptons. Nous observons que la différence entre ces deux moyennes se trouve dans l'intervalle [-1.38, 50.05] avec un niveau de confiance de 95%.


### Les postes des joueuses selon leur pays de naisssance

####  Tableau de contingence
```{r}
# Création du tableau de contingence
table_contingence <- table(pays, poste)

# Affichage du tableau de contingence
print(table_contingence)
```

````{r}
df <- as.data.frame.table(table_contingence)

# Renommer les colonnes du data frame
colnames(df) <- c("Pays", "Poste", "Effectif")

# Création du graphique en barres
ggplot(df, aes(x = Pays, y = Effectif, fill = Poste)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Pays", y = "Effectif", fill = "Poste") +
  theme_minimal()
````


// commenter


Nous avons remarqué grâce à l'analyse ci-dessous, qu'il y avait une donnée erronée dans notre jeu de données puisqu'il y avait une joueuse qui avait une hauteur de block à 0. Nous avons donc fait le choix de retirer cette joueuse du jeu de données.

## Analyse univariée sur la hauteur de block 
```{r}
block <- data$block
moyenne <- mean(block)
print(paste("La hauteur moyenne de block est de", round(moyenne, 2)))
variance <- var(block)
print(paste("La variance de la hauteur de block est de", round(variance, 2)))

# Analyse gaussienne
par(mfrow=c(1,2))
hist(block , main="Répartition de la hauteur de block ",xlab="Hauteur de block (en cm)",prob=T)
curve(dnorm(x, mean(block), sd(block)), col=2, add=TRUE, lty=2)
qqnorm(block)
qqline(block, col=2)

# Calcul de l'intervalle de confiance à 95% pour la moyenne
intervalle_de_confiance <- t.test(block)$conf.int
print(intervalle_de_confiance)

# Calcul de la proportion de blocs supérieurs à 280
proportion <- length(block[block > 280]) / length(block)
print(paste("La proportion de block dont la valeur est supérieure à 280 est de", proportion*100, "%"))

# Calcul de l'intervalle de confiance à 95% pour la proportion
int_confiance_prop <- prop.test(sum(block > 280), length(block))$conf.int
print(int_confiance_prop)
```

## Analyse univariée sur la taille des joueuses 
```{r}
taille <- data$taille
moyenne <- mean(taille)
print(paste("La taille moyenne d'une joueuse est de", round(moyenne, 2)))
variance <- var(taille)
print(paste("La variance de la taille des joueuses est de", round(variance, 2)))

# Analyse gaussienne
par(mfrow=c(1,2))
hist(taille , main="Répartition de la taille des joueuses",xlab="Taille des joueuses (en cm)",prob=T)
curve(dnorm(x, mean(taille), sd(taille)), col=2, add=TRUE, lty=2)
qqnorm(taille)
qqline(taille, col=2)

# Calcul de l'intervalle de confiance à 95% pour la moyenne
intervalle_de_confiance <- t.test(taille)$conf.int
print(intervalle_de_confiance)

# Calcul de la proportion de joueuses mesurant plus de 185 cm
proportion <- length(taille[taille > 185]) / length(taille)
print(paste("La proportion de joueuses mesurant plus de 185 cm est de", round(proportion*100, 2), "%"))

# Calcul de l'intervalle de confiance à 95% pour la proportion
int_confiance_prop <- prop.test(sum(taille > 185), length(taille))$conf.int
print(int_confiance_prop)
```



## Analyse multivariée 
# Quanti x quali

```{r}


```

Au vu des résultats ci-dessus, nous pouvons constater qu'il y a une nette différence entre 2 postes : les centrales et les liberos. Cette différence peut s'expliquer par le fait que le poste de libero est un poste où la joueuse ne reste que sur les bases arrières, c'est-à-dire qu'elle ne se trouve jamais devant le filet et n'a donc pas besoin de compétences particulières sur le côté détente verticale, tandis que les centrales à l'opposé des liberos ne font aucun poste arrière et sont présentes que sur les bases avant, donc uniquement devant le filet, et un des buts premier de leur poste est de bloquer les attaquantes adverses, d'où la nécessité pour elle d'avoir la meilleure hauteur au block.
Nous allons donc continuer notre analyse sur ces 2 sous groupes (centrales, liberos).

```{r}


```
