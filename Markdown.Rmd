---
title: "Projet Stats"
output:
  html_document: default
  pdf_document: default
date: "2023-05-05"
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

# Check if the package is installed; if not, install it
if (!require(ggplot2)) {
  install.packages("ggplot2")
  library(ggplot2)
}

```

# I. Introduction

Notre [jeu de données](https://www.kaggle.com/datasets/johnpendenque/women-volleyball-players) est récupéré du site Kaggle. 
Elles concernent des joueuses de volleyball de la FIVB (Fédération Internationale de VolleyBall) et contiennent des informations sur leur date de naissance, leur taille, leur poids, leur hauteur de saut, leur hauteur de bloc, leur poste de jeu et leur pays d'origine.


### Chargement du jeu de données 

```{r}

url <- "women_vb.csv"
data <- read.csv(url,sep=';', header=TRUE)

attach(data)

```

### Description et analyse des variables du jeu de données

Les données décrivent chaque joueuse de la manière suivante 

* __nom__ Le nom et le prénom de la joueuse
* __annee_naissance__ L date de naissance de la joueuse
* __taille__ La taille en cm de la joueuse
* __poids__ Le poids de la joueuse en kg
* __attaque__ La hauteur maximale d'attaque de la joueuse
* __block__ La hauteur maximale du block de la joueuse
* __poste__ Le poste occupé par la joueuse : Réceptionneuse/attaquante, centrale, pointue, libero, passeuse,
* __pays__ Le pays de naissance de la joueuse

Nous pouvons répartir nos données en 2 catégories :

| Quantitatives  | Qualitatives |
| :------------: |:------------:|
| Taille (en cm)  | Nom |
| Poids (en kg)  | Année de naissance |
| Attaque (en cm)  | Poste |
| Block (en cm)  | Pays de naissance |

Après consultation du contenu de notre jeu de données, nous constatons que notre fichier contient 432 lignes. Or, il y a énormément de doublons. En effet, il y a une répétition du jeu de données qui apparaît en 3 exemplaires. Nous avons donc supprimé les doublons, ce qui nous a amené à 144 lignes. Enfin nous sommes arrivées à 143 après avoir constaté qu'une joueuse avait une hauteur de block à 0 cm et avons donc fait le choix de retirer cette joueuse du jeu de données.

En résumé :

* Taille de l'échantillon = 143
* Unité statistique : individu (joueuses de volleyball)

Nos variables d'intérêt qualitatives seront le pays de naissance et le poste tandis que nos variables d'intérêt quantitatives seront la hauteur d'attaque et de bloc qui sont respectivement des variables continues puisqu'elles peuvent prendre toutes les valeurs possibles d'un intervalle de nombres réels, mais nous le confirmeront dans la suite de cette étude.

Nous pouvons donc pour le moment nous poser les questions suivantes :

* Est-ce que la taille d'une joueuse influe sur son poste ?


# II. Analyse du pays de naissance et de la hauteur d'attaque

## A. Variable qualitative d'intérêt - le pays de naissance des joueuses

Nous allons commencer par effectuer une analyse du pays de naissance des joueuses, qui est une variable _qualitative discrète_.


Pour résumer l'information contenue dans la variable nous commençons par un _tri à plat_.

```{r}

# Calculer les effectifs de chaque pays
pays_eff <- table(pays)

```


### Répartition des données

```{r}

# Créer les couleurs
pale_colors <- c("#F2B5D4", "#B8E3E6", "#FFDB9A", "#B3D9B2", "#FAC8A7", "#D7D7E0",
                "#F9E6B8", "#B7C9E2", "#F1C2DC", "#C9E8C9", "#FFE4C4", "#D0E0EB")

# Créer le diagramme en camembert
pie(pays_eff, paste(names(pays_eff), "(", formatC(pays_eff, format = "f", digits = 0), ")", sep = ""), col = pale_colors)

# Ajouter la legende
legend("topright", legend = names(pays_eff), fill = pale_colors, cex = 0.8)

```

En analysant ce diagramme, il est clair que la plupart des pays de naissance des joueuses ont une fréquence de 12, ce qui signifie qu'il y a un nombre égal de joueuses nées dans ces pays. Cependant, il y a deux exceptions à cette tendance : le Japon et le Mexique, qui sont les pays de naissance de 11 joueuses chacun.

Il est intéressant de noter que la Bulgarie présente la fréquence maximale dans ce diagramme, avec 13 joueuses nées dans ce pays. Cela indique que la Bulgarie est le pays d'origine le plus représenté parmi les joueuses.


## B. Variable quantitative d'intérêt - la hauteur d'attaque des joueuses

```{r}
# Calcul de la fonction de répartition empirique
ecdf_attaque <- ecdf(attaque)

# Tracé de la fonction de répartition empirique
plot(ecdf_attaque, main = "Fonction de répartition empirique - Attaque", xlab = "Attaque", ylab = "Probabilité", xlim = range(attaque))

```

Les nombreux sauts de petite taille observés dans la variable suggèrent fortement que cette variable _quantitative_ est _continue_.

Étant donné que la variable en question est continue, il est approprié de réaliser un regroupement en classes des données.

```{r}
# Regroupement en classes
classes_attaque <- cut(attaque,breaks = c(100, 200, 300, 400))

# Affichage des classes
print(classes_attaque)
```

Dans le cadre de notre analyse, nous supposons que les points de données au sein de chaque classe sont répartis uniformément.


### Rapport de corrélation

```{r}

cor(block, attaque)

```

### Mesures de position

```{r}
boxplot(attaque, main="La hauteur d'attaque des joueuses de volley")
```

En observant ce diagramme, on peut clairement distinguer la valeur minimale, les quartiles, la médiane et la valeur maximale.

Voici ces valeurs 

```{r}
summary(attaque)
```


### Probabilité et estimations 

#### Estimation de moyenne

```{r}
interval=t.test(attaque)
interval$conf.int
mean(attaque)
```

Nous pouvons estimer que la moyenne de l'attaque se situe dans l'intervalle [284.5521, 293.0283] avec un niveau de confiance de 95%.


#### Estimation de variance 

```{r}
# Calcul de l'intervalle de confiance pour la variance
n <- length(attaque)  # Taille de l'échantillon
alpha <- 0.05  # Niveau de confiance (ici 95%)

lower_bound <- (n - 1) * var(attaque) / qchisq(1 - alpha/2, df = n - 1)
upper_bound <- (n - 1) * var(attaque) / qchisq(alpha/2, df = n - 1)

# Affichage de l'intervalle de confiance
confidence_interval <- c(lower_bound, upper_bound)
confidence_interval
var(attaque)
```

De même nous estimons que la variance de la hauteur d'attaque des joueuses se situe dans l'intervalle [527.6508 841.5602] avec un niveau de confiance de 95%.


#### Comparaison à la loi normale

```{r}
par(mfrow=c(1,2))
hist(attaque , main="Repartition de la hauteur d'attaque ",xlab="La hauteur d'attaque",prob=T)
curve(dnorm(x, mean(attaque), sd(attaque)), col=2, add=TRUE, lty=2)

qqnorm(attaque, main = "La loi normale", xlab = "Théorique", ylab = "Observé")
abline(mean(attaque),sd(attaque),col=2)
```

Sur ce graphique, nous pouvons observer que la distribution de la variable d'attaque s'approche de la loi normale.

Pour valider notre estimation, nous procéderons aux tests statistiques.


#### Test de la normalité de distribution

Les hypothèses sont les suivantes :

* H0 : La variable suit la loi normale
* H1 : La variable ne suit pas la loi normale

```{r}
shapiro.test(attaque)
```

La p valeur du test est extrêmement faible, soit 1.619e-13, ce qui indique que nous avons suffisamment de preuves pour rejeter l'hypothèse nulle  H0 selon laquelle les données suivent une distribution normale.


## C. Analyse bivariée - Pays de naissance x Hauteur d'attaque

Après avoir étudié les pays de naissance des joueuses et leurs hauteurs d'attaque, nous pouvons désormais analyser la hauteur d'attaque selon le pays de naissance des joueuses.

La hauteur d'attaque des joueuses est une variable _quantitative continue_, tandis que leur pays de naissance est une variable _qualitative discrète_.

```{r}
attaque<-data$attaque

ggplot(data, aes(x = pays, y = attaque)) +
  geom_boxplot() +
  labs(title = "La hauteur d'attaque moyenne des joueuses en fonction de leur pays de naissance",
       x = "Pays de naissance",
       y = "La hauteur d'attaque") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Ce graphique en boîte permet d'observer les quartiles et la médiane de la hauteur d'attaque des joueuses des différents sous-groupes, représentés par leur nationalité. Chaque boîte représente la distribution de la hauteur d'attaque pour un pays spécifique.

Maintenant que nous avons examiné les résultats graphiques, nous pouvons utiliser ces données pour effectuer des tests statistiques. Voici les tests que nous effectuerons en utilisant les résultats de la hauteur d'attaque des différentes nationalités :

* Test de comparaison de moyennes : Sur le graphique, nous remarquons une similitude des moyennes de la hauteur d'attaque entre la Chine et Cuba. Afin de vérifier si cette similitude est statistiquement significative, nous allons effectuer un test d'égalité des moyennes entre ces deux pays.
* Test de comparaison de variances : De même nous observons une similarité entre les variances enre la Cuba et l'Egypte, nous allons donc effectuer un test d'égalité des moyennes pour ces deux pays et ensuite un test d'égalité des variances.


### Tests statistiques 

* Test d'égalité des moyennes de la hauteur d'attaque entre la Chine et la Cuba. Les hypothèses sont les suivantes 

  + H0 Les moyennes sont égales
  + H1 Les moyennes sont différentes


### Tests d'égalité des moyennes

```{r}
attaque_cuba <- attaque[pays == "Cuba"]
attaque_china <- attaque[pays == "China"]
t.test(attaque_cuba, attaque_china)
```

La p-valeur est grande (26,32%) par rapport au risque de 5% de se tromper. Nous pouvons donc accepter l'hypothèse nulle HO selon laquelle les deux moyennes sont égales et rejetter l'hypothèse H1 selon laquelle les deux moyennes sont différentes. Nous constatons également que la différence entre ces deux moyennes se trouve dans l'intervalle [-32.8, 9.8] avec un niveau de confiance de 95%.


### Tests d'égalité des variances

Pour effectuer des tests d'égalité des variances, il est recommandé de vérifier d'abord l'adéquation à la distribution normale des échantillons concernés. Dans notre cas, nous avons deux sous-groupes : Cuba et Égypte. Nous allons donc procéder à des tests de normalité pour ces deux groupes.

Les hypothèses sont les suivantes :

* H0 : La variable suit la loi normale
* H1 : La variable ne suit pas la loi normale 

```{r}
hist(data[data$pays == "Cuba", "attaque"])
shapiro.test(data[data$pays == "Cuba", "attaque"])
hist(data[data$pays == "Egypte", "attaque"])
shapiro.test(data[data$pays == "Egypte", "attaque"])
```

Pour les deux tests la p-valeur obtenue est petite, donc nous ne pouvons pas rejjeter l'hypothèse nulle selon laquelle la variable suit la loi normale. Nous supposons donc par la suite que ces deux échantillons ne suivent pas une distribution normale.

Vu que nos échantillons ne suivent pas une distribution normale de ces deux échantillon avec un test Fisher

Test d'égalité des variance entre la Cuba et l'Egypte :

* H0 Les variances sont égales
* H1 Les variances sont différentes
  
````{r}
attaque_egypt <- attaque[pays == "Egypte"]
var.test(attaque_cuba, attaque_egypt)
````

La p-valeur est petite mais légérement plus grande que le risque de 5% nous ne pouvons donc pas rejetter l'hypothèse nulle selon laquelle les variances sont égales.

Nous supposons dans la suite que les variances de ces deux échantillons sont égales.


Test d'égalité des moyennes de la hauteur d'attaque entre la Cuba et l'Égypte. Les hypothèses sont les suivantes :

* H0 Les moyennes sont égales
* H1 Les moyenne sont différentes

```{r}
t.test(attaque_cuba, attaque_egypt, var.equal = T)
```

La p-valeur est plus petite que dans le premier test mais elle reste supérieure au risque de 5%. Nous n'avons donc pas suffisament de preuve pour rejetter l'hypothèse nulle HO selon laquelle les deux moyennes sont égales par consequent nous l'acceptons. Nous observons que la différence entre ces deux moyennes se trouve dans l'intervalle [-1.38, 50.05] avec un niveau de confiance de 95%.


## III. Le postes des joueuses selon leur pays de naisssance

###  Tableau de contingence

```{r}
# Création du tableau de contingence
table_contingence <- table(pays, poste)

# Affichage du tableau de contingence
print(table_contingence)
```

````{r}
df <- as.data.frame.table(table_contingence)

# Renommer les colonnes du data frame
colnames(df) <- c("Pays", "Poste", "Effectif")

# Création du graphique en barres
ggplot(df, aes(x = Pays, y = Effectif, fill = Poste)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Pays", y = "Effectif", fill = "Poste") +
  theme_minimal()
````

// commenter


# IV. Analyse de la hauteur de block et du poste des joueuses

## A. Variable quantitative d'intérêt - la hauteur de block

Afin de faire notre analyse mutlivariée, nous allons étudier chacune des variables que nous allons utiliser. Commencons par l'analyse sur la hauteur de block qui est une varibale _quantitative continue_.


### Moyenne

```{r}

# Calcul de la hauteur moyenne de block
mean(block)

# Calcul de l'intervalle de confiance à 95% pour la moyenne
intervalle_de_confiance <- t.test(block)$conf.int
intervalle_de_confiance

```

La moyenne est de 277.4336 cm et nous avons l'intervalle de confiance suivant avec 95% de confiance [273.4524, 281.4148].


### Variance

```{r}

# Calcul de la variance de la hauteur de block
var(block)

# Calcul de l'intervalle de confiance à 95% pour la variance
n <- length(block)  # Taille de l'échantillon
alpha <- 0.05  # Niveau de confiance (ici 95% car 0.05 de risque)
lower_quantile<- (n - 1) * var(block) / qchisq(1 - alpha/2, df = n - 1)
upper_quantile <- (n - 1) * var(block) / qchisq(alpha/2, df = n - 1)
confidence_interval <- c(lower_quantile, upper_quantile)
confidence_interval

```

La moyenne est de 277.4336 cm et nous avons l'intervalle de confiance suivant avec 95% de confiance [465.6286, 742.6398].


### Proportion

```{r}

# Calcul de la proportion de blocs supérieurs à 280
proportion <- length(block[block > 280]) / length(block)

# Calcul de l'intervalle de confiance à 95% pour la proportion
int_confiance_prop <- prop.test(sum(block > 280), length(block))$conf.int
int_confiance_prop

```

La proportion de block dont la valeur est supérieure à 280 cm est de 56.64 % et nous avons l'intervalle de confiance suivant avec 95% de confiance [0.4810458, 0.6481979].


### Analyse gaussienne

Nous allons regarder si notre variable peut être approchée par un modèle Gaussien.

```{r}

par(mfrow=c(1,2))
hist(block , main="Répartition de la hauteur de block ",xlab="Hauteur de block (en cm)",prob=T)
curve(dnorm(x, mean(block), sd(block)), col=2, add=TRUE, lty=2)

qqnorm(block)
abline(mean(block), sd(block), col=2)

```

Nous pouvons constater que la hauteur de block se rapproche de la loi normale par une courbe gaussienne.
Pour valider ce constat, nous allons procéder à des tests statistiques.


### Test statistique sur la normalité de distribution

Les hypothèses sont les suivantes :

* H0 : La variable de block suit la loi normale 
* H1 : La variable de block ne suit pas la loi normale

```{r}

shapiro.test(block)

```

La p-valeur de 9.095e-13 est particulièrement faible. Cela nous permet de rejeter l'hypothèse H0 selon laquelle la variable de block suit la loi normale et d'être sûr de cette décision.


## B. Variable qualitative d'intérêt - le poste des joueuses

Afin de faire notre analyse mutlivariée, nous allons étudier la deuxième des variables que nous allons utiliser : le poste des joueuses, qui est une variable _qualitative discrète_.


### Représentation de la variable de poste

Pour résumer l'information contenue dans la variable de poste, nous commençons par réaliser un _tri à plat_.

```{r}

# Calculer les effectifs de chaque pays
frequence_poste <- table(poste)
frequence_poste

```

48% de notre échantillon est représenté par les pointues. Une répartition est quasi équitable entre les passeuses et les réceptionneuses/attaquantes, tandis que l'on retrouve un peu plus du double de centrale que de libero qui est le poste le moins représenté dans notre échantillon.
Afin de mieux visualiser ce résultat, voici un diagramme en barre représentant les données ci-dessus :

```{r}

barplot(table(poste), main = "Diagramme en barres sur la fréquence des postes", xlab = "Poste", ylab = "Fréquence")

```


## Analyse multivariée sur la hauteur de block par rapport au poste des joueuses

Jusqu'à présent, nous avons regardé chaque variable de façon indépendante. Maintenant, nous allons prendre en compte, mesurer et analyser les liens qui peuvent exister entre ces deux variables.

```{r}

boxplot(block~poste)

var(poste=="Centrale")

```

Ce graphique en boîte permet d'observer les quartiles et la médiane de la hauteur de bloc des joueuses des différents sous-groupes, représentés par leur poste. Chaque boîte représente la distribution de la hauteur de bloc pour un poste spécifique.

Maintenant que nous avons examiné les résultats graphiques, nous pouvons utiliser ces données pour effectuer des tests statistiques. Voici les tests que nous allons effectuer en utilisant les résultats de la hauteur de bloc des différents postes :

* Test de comparaison de moyennes : Sur le graphique, nous remarquons une similitude des moyennes de la hauteur de bloc entre les pointues et les receptionneuses attaquantes. Afin de vérifier si cette similitude est statistiquement significative, nous allons effectuer un test d'égalité des moyennes entre ces deux postes.
* Test de comparaison de variances : De même nous observons une similarité entre les variances entre des liberos et des passeuses, nous allons donc effectuer un test d'égalité des variances pour ces deux postes.


### Tests d'égalité des moyennes

* Test d'égalité des moyennes de la hauteur de bloc entre les pointues et les receptionneuses attaquantes. Les hypothèses sont les suivantes :

* H0 Les moyennes sont égales
* H1 Les moyennes sont différentes

```{r}
block_pointue <- block[poste == "Pointue"]
block_recepattaque <- block[poste == "Receptionneuse/attaquante"]
t.test(block_pointue, block_recepattaque)
```

La p-valeur est supérieure à 5% (7.8%). Nous pouvons donc accepter l'hypothèse nulle HO selon laquelle les deux moyennes sont égales et rejetter l'hypothèse H1 selon laquelle les deux moyennes sont différentes. Nous constatons également que la différence entre ces deux moyennes se trouve dans l'intervalle [-22.648614, 1.273614] avec un niveau de confiance de 95%.


#### Tests d'égalité des variances

Pour effectuer des tests d'égalité des variances, il est recommandé de vérifier d'abord l'adéquation à la distribution normale des échantillons concernés. Dans notre cas, nous avons deux sous-groupes : les passeuses et les liberos. Nous allons donc procéder à des tests de normalité pour ces deux groupes.

Les hypothèses sont les suivantes :

* H0 : Les variances sont égales
* H1 : Les variances sont différentes

```{r}

hist(data[data$poste == "Passeuse", "block"])
shapiro.test(data[data$poste == "Passeuse", "block"])

hist(data[data$poste == "Libero", "block"])
shapiro.test(data[data$poste == "Libero", "block"])

```
Pour les deux tests la p-valeur obtenue est petite, donc nous ne pouvons pas rejeter l'hypothèse nulle selon laquelle la variable suit la loi normale. Nous supposons donc par la suite que ces deux échantillons ne suivent pas une distribution normale.

Vu que nos échantillons ne suivent pas une distribution normale, procédons à ce que l'on appelle un test de Fisher.

Test d'égalité des variance entre les passeuses et les liberos : 

* H0 : Les variances sont égales
* H1 : Les variances sont différentes

````{r}

block_passeuse <- block[poste == "Passeuse"]
block_libero <- block[poste == "Libero"]
var.test(block_libero, block_passeuse)

````

La p-valeur est petite et légérement en dessous du risque de 5%. Nous pouvons donc rejetter l'hypothèse nulle selon laquelle les variances sont égales.

Nous supposons dans la suite que les variances de ces deux échantillons sont différentes.


Test d'égalité des moyennes de la hauteur de block entre les passeuses et les liberos. Les hypothèses sont les suivantes :

* H0 Les moyennes sont égales
* H1 Les moyenne sont différentes

```{r}

t.test(block_libero, block_passeuse, var.equal = T)

```

```{r}

popCentrale <- data[data$poste == "Centrale", ]
boxplot(popCentrale$block, main = "Boxplot des joueuses centrales", ylab = "Hauteur")

popLibero <- data[data$poste == "Libero", ]
boxplot(popLibero$block, main = "Boxplot des joueuses liberos", ylab = "Hauteur")

```

## Nuage de points

Définissons nos variables. Nous allons utiliser la hauteur d'attaque comme variable aléatoire observable et la taille comme variable déterministe (non aléatoire) observable.

```{r}

ggplot(data,aes(x=taille,y=attaque))+ geom_point()+
xlab("Taille")+
ylab("Hauteur d'attaque")

```

On remarque ici que le nuage de points n'est pas très éloigné d'une ligne, mais contient quand même quelques données écartées. Nous allons donc faire une régression linéaire simple.


## Simple régression

```{r}

simple_reg <- lm(attaque~taille,data=data)
summary(simple_reg)
ggplot(data,aes(x=taille,y=attaque))+ geom_point()+
stat_smooth(method="lm",se=FALSE)+ xlab("Taille")+
ylab("Attaque")
anova(simple_reg)

```

La valeur de R² étant 0.4039 est un peu éloignée de 1, mais n'est pas extrêmement faible non plus. Nous pouvons dire que ce résultat provient du fait que nous avons un échantillon  de taille limitée ne nous permettant pas d'avoir une analyse assez solide.

La valeur de SSE est de 55637 tandis que celle de SSM est de 37695, nous constatons qu'il y a bien une différence mais pas clairement significative, mais cela nous permet de conclure sur le fait qu'on ne peut pas établir une corrélation avec nos données.
